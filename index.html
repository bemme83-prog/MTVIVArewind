<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VIVA & MTV - Test v4.0</title>
    <style>
        :root { --viva-blue: #1a4a9e; --viva-yellow: #ffff00; --viva-pink: #ff00ff; }
        body, html { margin: 0; padding: 0; height: 100%; width: 100%; overflow: hidden; background-color: black; font-family: 'Arial Black', sans-serif; }
        
        #portal-overlay { position: fixed; inset: 0; z-index: 20000; background: #000; display: flex; justify-content: center; align-items: center; }
        .start-btn { padding: 20px 40px; font-size: 24px; background: var(--viva-yellow); color: var(--viva-blue); border: none; cursor: pointer; border-radius: 10px; }
        
        #viva-view { position: absolute; inset: 0; display: none; }
        .viva-clock { position: absolute; top: 30px; left: 35px; z-index: 100; font-size: 28px; color: var(--viva-yellow); text-shadow: 3px 3px 0px var(--viva-blue); }
        .version-tag { position: absolute; bottom: 10px; right: 10px; color: #333; font-size: 10px; }
        #container-music { position: absolute; inset: 0; z-index: 10; }
        #viva-tag { position: absolute; bottom: 25%; left: 0; z-index: 200; background: var(--viva-yellow); color: var(--viva-blue); padding: 10px 20px; transform: translateX(-110%); transition: 0.5s; }
        #viva-tag.show { transform: translateX(0); }
    </style>
</head>
<body>

    <div id="portal-overlay">
        <button class="start-btn" onclick="launch()">START VIVA TEST (30s INTERVALL)</button>
        <div class="version-tag">v4.0-test-timer</div>
    </div>

    <div id="viva-view">
        <div id="viva-clock" class="viva-clock">00:00</div>
        <div id="viva-tag"><div id="viva-title">LADE...</div></div>
        <div id="container-music"><div id="player"></div></div>
    </div>

    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
        let player, testTimer;
        let isClipPlaying = false;
        const musicPlaylist = 'PLfYJatUfKgnlRa5IM0KI_ll0UyhYItnU2';
        const clipPlaylist = 'PLQ7SWY9Xieg3hXzm58s84PRe53LttQbJl';
        
        // Liste der Clip-IDs (statisch für den Test, um API-Hänger zu vermeiden)
        const clipIds = ['S1vH0f-X5X0', 'Xq-lnR_I8sk', 'W7m9L8eS-E4', '9j-xLp2U984'];

        function launch() {
            document.getElementById('portal-overlay').style.display = 'none';
            document.getElementById('viva-view').style.display = 'block';
            startTestTimer();
        }

        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                height: '100%', width: '100%',
                playerVars: { autoplay: 1, controls: 0, modestbranding: 1, rel: 0, iv_load_policy: 3, enablejsapi: 1 },
                events: {
                    'onReady': (e) => {
                        e.target.loadPlaylist({ list: musicPlaylist, index: Math.floor(Math.random() * 100) });
                        e.target.setShuffle(true);
                    },
                    'onStateChange': (e) => {
                        if (e.data === YT.PlayerState.PLAYING && !isClipPlaying) {
                            showTag(e.target.getVideoData().title);
                        }
                        if (e.data === YT.PlayerState.ENDED && isClipPlaying) {
                            returnToMusic();
                        }
                    },
                    'onError': () => { player.nextVideo(); }
                }
            });
        }

        function startTestTimer() {
            // Alle 30 Sekunden einen Spot erzwingen
            testTimer = setInterval(() => {
                if (!isClipPlaying) {
                    playRandomClip();
                }
            }, 30000);
        }

        function playRandomClip() {
            console.log("Testeinschub: Spot wird geladen...");
            isClipPlaying = true;
            const randomClip = clipIds[Math.floor(Math.random() * clipIds.length)];
            
            // Wir nutzen loadVideoById statt loadPlaylist, das ist stabiler für Einzelschüsse
            player.loadVideoById(randomClip);
        }

        function returnToMusic() {
            console.log("Spot beendet, zurück zur Musik...");
            isClipPlaying = false;
            player.loadPlaylist({ list: musicPlaylist, index: Math.floor(Math.random() * 100) });
            player.setShuffle(true);
        }

        function showTag(title) {
            if (!title) return;
            document.getElementById('viva-title').innerText = title;
            const tag = document.getElementById('viva-tag');
            tag.classList.add('show');
            setTimeout(() => tag.classList.remove('show'), 6000);
        }

        setInterval(() => {
            document.getElementById('viva-clock').innerText = new Date().toLocaleTimeString('de-DE', {hour: '2-digit', minute:'2-digit'});
        }, 1000);
    </script>
</body>
</html>
